(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"4cd0":function(t,n,o){"use strict";(function(t){o("8b85");e(o("66fd"));var n=e(o("c9c7"));function e(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=o,t(n.default)}).call(this,o("543d")["createPage"])},9069:function(t,n,o){"use strict";var e=o("9c39"),i=o.n(e);i.a},"9c39":function(t,n,o){},ba59:function(t,n,o){"use strict";var e;o.d(n,"b",(function(){return i})),o.d(n,"c",(function(){return a})),o.d(n,"a",(function(){return e}));var i=function(){var t=this,n=t.$createElement;t._self._c},a=[]},c9c7:function(t,n,o){"use strict";o.r(n);var e=o("ba59"),i=o("e09b");for(var a in i)"default"!==a&&function(t){o.d(n,t,(function(){return i[t]}))}(a);o("9069");var c,s=o("f0c5"),u=Object(s["a"])(i["default"],e["b"],e["c"],!1,null,"0efb532e",null,!1,e["a"],c);n["default"]=u.exports},e09b:function(t,n,o){"use strict";o.r(n);var e=o("e2d9"),i=o.n(e);for(var a in e)"default"!==a&&function(t){o.d(n,t,(function(){return e[t]}))}(a);n["default"]=i.a},e2d9:function(t,n,o){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o={data:function(){return{nbTitle:"",nbFrontColor:"#ffffff",nbBackgroundColor:"#393939",scrollTop:0,contentsTop:0,showDetail:!1,actIndex:0,categoryList:[],dataList:[],nums:0,totalMoney:0,productList:[],imgHost:this.imgHost,shopInfo:{},vmid:t.getStorageSync("vmid")||""}},onLoad:function(n){n.vmid&&(t.setStorageSync("vmid",n.vmid),this.vmid=n.vmid)},onShow:function(){var n=this;t.hideLoading(),""==this.vmid?t.showToast({title:"请重新扫码",icon:"none"}):this.$request({url:"/redapi/getShopInfo",data:{vmid:this.vmid},method:"POST"}).then((function(o){t.setStorageSync("shopInfo",JSON.stringify(o.data)),n.shopInfo=o.data})).catch((function(t){console.log(t)})),t.getStorageSync("shopInfo")&&(this.nbTitle=JSON.parse(t.getStorageSync("shopInfo")).vmname||""),t.$on("handleFun",(function(o){n.nums=0,n.totalMoney=0,n.getProductList(),t.$off("handleFun")}))},mounted:function(){console.log("index mounted"),this.getProductList()},methods:{getProductList:function(){var n=this;t.showLoading({mask:!0}),this.$request({url:"/redapi/productList",data:{vmid:this.vmid},method:"POST"}).then((function(o){n.productList=o.list,n.productList.forEach((function(t){t.num=0,n.categoryList.includes(t.category_name)||n.categoryList.push(t.category_name)})),n.filterData(),t.hideLoading()})).catch((function(n){t.hideLoading(),t.showToast({title:n,icon:"none"})}))},clearFun:function(){var n=this;t.showModal({title:"温馨提示",content:"确定清空购物车？",success:function(t){t.confirm?(n.nums=0,n.totalMoney=0,n.productList.forEach((function(t){t.num=0})),n.showDetail=!1,n.$forceUpdate()):t.cancel&&console.log("用户点击取消")}})},totalFun:function(){var t=this;this.nums=0,this.totalMoney=0,this.productList.forEach((function(n){n.num>0&&(t.nums+=n.num,t.totalMoney+=n.num*(100*n.price))}))},proClick:function(n,o){if(1==o)n.num-=1;else{if(!(n.num<n.maxNum))return void t.showToast({title:"库存不足",icon:"none"});n.num+=1}this.productList.forEach((function(t){t.product_id==n.product_id&&(t.num=n.num)})),this.totalFun(),this.$forceUpdate()},cateFun:function(t,n){this.actIndex=n,this.filterData()},filterData:function(){var t=this;this.dataList=[],this.productList.forEach((function(n){n.category_name==t.categoryList[t.actIndex]&&t.dataList.push(n)}))},goNext:function(){if(t.getStorageSync("token")){if(0==this.totalMoney)return;t.navigateTo({url:"/pages/index/pay"})}else this.registFun()},registFun:function(){var n=this;t.getUserProfile({desc:"Wexin",success:function(o){t.setStorageSync("userInfo",o.rawData);var e=JSON.parse(o.rawData);t.showLoading({mask:!0}),wx.login({success:function(o){var i=o.code;n.$request({url:"/redapi/wxgetOpenId?js_code=".concat(i,"&headimg=").concat(e.avatarUrl,"&nickname=").concat(e.nickName,"&gender=").concat(e.gender),data:{},method:"POST"}).then((function(t){var o={headimg:e.avatarUrl,nickname:e.nickName,gender:e.gender,openid:t.data.openid};n.loginFun(o)})).catch((function(n){t.hideLoading(),console.log(n)}))}})},fail:function(t){console.log(t)}})},loginFun:function(n){this.$request({url:"/redapi/regist",data:n,method:"POST"}).then((function(n){t.setStorageSync("token",n.token),t.hideLoading()})).catch((function(n){t.hideLoading(),t.showToast({title:n,icon:"none"})}))},showDFun:function(){0!=this.totalMoney&&(this.showDetail=!this.showDetail)}}};n.default=o}).call(this,o("543d")["default"])}},[["4cd0","common/runtime","common/vendor"]]]);